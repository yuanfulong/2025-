{% extends "base.html" %}

{% block title %}æœç´¢æŸ¥è¯¢ - æ ¡å›­å¤±ç‰©æ‹›é¢†å¹³å°{% endblock %}

{% block content %}
<div class="page-title">
    <h2>æœç´¢æŸ¥è¯¢</h2>
    <p>é€šè¿‡å…³é”®è¯å’Œç­›é€‰æ¡ä»¶å¿«é€Ÿæ‰¾åˆ°æ‚¨çš„å¤±ç‰© ğŸ”</p>
</div>

<!-- æœç´¢è¡¨å• -->
<div class="card">
    <form method="GET" action="/search" style="display: grid; gap: 1rem;">
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 1rem; align-items: end;">
            <div class="form-group" style="margin-bottom: 0;">
                <label for="keyword">å…³é”®è¯æœç´¢</label>
                <input type="text" id="keyword" name="keyword" class="form-control" 
                       value="{{ current_keyword }}" 
                       placeholder="è¾“å…¥ç‰©å“åç§°ã€åœ°ç‚¹æˆ–æè¿°å…³é”®è¯">
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="category">ç‰©å“ç±»åˆ«</label>
                <select id="category" name="category" class="form-control">
                    <option value="">å…¨éƒ¨ç±»åˆ«</option>
                    {% for category in categories %}
                        <option value="{{ category }}" 
                                {% if current_category == category %}selected{% endif %}>
                            {{ category }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="type">ä¿¡æ¯ç±»å‹</label>
                <select id="type" name="type" class="form-control">
                    <option value="all" {% if current_type == 'all' %}selected{% endif %}>å…¨éƒ¨ä¿¡æ¯</option>
                    <option value="lost" {% if current_type == 'lost' %}selected{% endif %}>é—å¤±ç‰©å“</option>
                    <option value="found" {% if current_type == 'found' %}selected{% endif %}>æ‹¾åˆ°ç‰©å“</option>
                </select>
            </div>
            
            <button type="submit" class="btn" style="padding: 12px 24px;">
                ğŸ” æœç´¢
            </button>
        </div>
    </form>
</div>

<!-- æœç´¢ç»“æœç»Ÿè®¡ -->
{% if current_keyword or current_category or current_type != 'all' %}
<div style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 10px;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div>
            <strong>æœç´¢ç»“æœï¼š</strong>
            {% if current_keyword %}å…³é”®è¯"{{ current_keyword }}" â€¢ {% endif %}
            {% if current_category %}ç±»åˆ«"{{ current_category }}" â€¢ {% endif %}
            {% if current_type != 'all' %}ç±»å‹"{{ 'é—å¤±ç‰©å“' if current_type == 'lost' else 'æ‹¾åˆ°ç‰©å“' }}" â€¢ {% endif %}
            å…±æ‰¾åˆ° <span style="color: #667eea; font-weight: bold;">{{ total_count }}</span> æ¡è®°å½•
        </div>
        <a href="/search" class="btn" style="padding: 8px 16px; font-size: 14px;">
            æ¸…ç©ºæ¡ä»¶
        </a>
    </div>
</div>
{% endif %}

<!-- æœç´¢ç»“æœ -->
{% if items %}
<div style="display: grid; gap: 1rem;">
    {% for item in items %}
    <div class="card" style="position: relative;">
        <div style="position: absolute; top: 1rem; right: 1rem;">
            <span class="badge badge-{{ item.type_class }}" 
                  style="padding: 8px 15px; border-radius: 20px; font-size: 12px; font-weight: bold;
                         {% if item.type_class == 'lost' %}
                             background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); color: #721c24;
                         {% else %}
                             background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); color: #155724;
                         {% endif %}">
                {{ item.type }}
            </span>
        </div>
        
        <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 2rem; align-items: start;">
            <div style="text-align: center; min-width: 80px;">
                <div style="font-size: 3rem; margin-bottom: 0.5rem;">
                    {% if item.category == 'é’±åŒ…' %}ğŸ’°
                    {% elif item.category == 'é’¥åŒ™' %}ğŸ”‘
                    {% elif item.category == 'ä¹¦ç±' %}ğŸ“š
                    {% elif item.category == 'ç”µå­äº§å“' %}ğŸ“±
                    {% else %}ğŸ“¦{% endif %}
                </div>
                <div style="background: #f8f9fa; padding: 4px 8px; border-radius: 5px; font-size: 12px; color: #666;">
                    {{ item.category }}
                </div>
            </div>
            
            <div>
                <h3 style="color: #2c3e50; margin-bottom: 1rem; font-size: 1.5rem;">
                    {{ item.name }}
                </h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #667eea;">ğŸ“</span>
                        <strong>åœ°ç‚¹ï¼š</strong>{{ item.place }}
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #667eea;">ğŸ“…</span>
                        <strong>æ—¥æœŸï¼š</strong>{{ item.date }}
                    </div>
                    {% if item.contact %}
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #667eea;">ğŸ“</span>
                        <strong>è”ç³»ï¼š</strong>{{ item.contact }}
                    </div>
                    {% endif %}
                </div>
                
                {% if item.description %}
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border-left: 4px solid #667eea;">
                    <strong style="color: #2c3e50;">è¯¦ç»†æè¿°ï¼š</strong><br>
                    <span style="color: #555;">{{ item.description }}</span>
                </div>
                {% endif %}
            </div>
            
            <div style="text-align: right; min-width: 120px;">
                <div style="color: #999; font-size: 0.9rem; margin-bottom: 1rem;">
                    ç™»è®°æ—¶é—´<br>{{ item.created_at }}
                </div>
                {% if item.contact %}
                <button onclick="showContact('{{ item.contact }}')" class="btn" style="padding: 8px 16px; font-size: 14px;">
                    è”ç³»{{ 'å¤±ä¸»' if item.type_class == 'found' else 'æ‹¾è·è€…' }}
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- åˆ†é¡µæç¤º -->
{% if items|length >= 20 %}
<div style="text-align: center; margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 10px;">
    <p style="color: #666;">æ˜¾ç¤ºäº†æœ€æ–°çš„ {{ items|length }} æ¡è®°å½•</p>
</div>
{% endif %}

{% else %}
<!-- æ— æœç´¢ç»“æœ -->
<div class="card" style="text-align: center; padding: 3rem;">
    <div style="font-size: 5rem; margin-bottom: 1rem; opacity: 0.5;">ğŸ”</div>
    <h3 style="color: #666; margin-bottom: 1rem;">æœªæ‰¾åˆ°ç›¸å…³å¤±ç‰©ä¿¡æ¯</h3>
    <p style="color: #999; margin-bottom: 2rem;">
        {% if current_keyword or current_category or current_type != 'all' %}
            è¯·å°è¯•ä¿®æ”¹æœç´¢æ¡ä»¶æˆ–æŸ¥çœ‹å…¨éƒ¨ä¿¡æ¯
        {% else %}
            å½“å‰è¿˜æ²¡æœ‰å¤±ç‰©ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å…ˆç™»è®°æ‚¨çš„å¤±ç‰©
        {% endif %}
    </p>
    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        {% if current_keyword or current_category or current_type != 'all' %}
        <a href="/search" class="btn">æŸ¥çœ‹å…¨éƒ¨ä¿¡æ¯</a>
        {% endif %}
        <a href="/register" class="btn btn-secondary">ç™»è®°å¤±ç‰©ä¿¡æ¯</a>
    </div>
</div>
{% endif %}

<!-- å¿«é€Ÿæ“ä½œ -->
<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; margin-top: 2rem;">
    <h3 style="margin-bottom: 1rem;">æ²¡æ‰¾åˆ°æƒ³è¦çš„ç»“æœï¼Ÿ</h3>
    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <a href="/register" class="btn" style="background: rgba(255,255,255,0.2); color: white;">
            ç™»è®°æ–°çš„å¤±ç‰©ä¿¡æ¯
        </a>
        <a href="/contact" class="btn" style="background: rgba(255,255,255,0.2); color: white;">
            è”ç³»ç®¡ç†å‘˜æ±‚åŠ©
        </a>
    </div>
</div>

<!-- è”ç³»ä¿¡æ¯æ¨¡æ€æ¡† -->
<div id="contactModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                                background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                background: white; padding: 2rem; border-radius: 15px; max-width: 400px; width: 90%;">
        <h3 style="color: #2c3e50; margin-bottom: 1rem; text-align: center;">è”ç³»æ–¹å¼</h3>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; text-align: center; margin-bottom: 1.5rem;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“</div>
            <p id="contactInfo" style="font-size: 1.1rem; font-weight: bold; color: #667eea;"></p>
        </div>
        <div style="text-align: center;">
            <button onclick="closeContact()" class="btn">å…³é—­</button>
        </div>
    </div>
</div>

<script>
    function showContact(contact) {
        document.getElementById('contactInfo').textContent = contact;
        document.getElementById('contactModal').style.display = 'block';
    }
    
    function closeContact() {
        document.getElementById('contactModal').style.display = 'none';
    }
    
    // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
    document.getElementById('contactModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeContact();
        }
    });
    
    // ESCé”®å…³é—­æ¨¡æ€æ¡†
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeContact();
        }
    });
</script>
{% endblock %}